name: Pull request

on:
  pull_request:
    branches:
      - main

env:
  ARM_SUBSCRIPTION_ID: ${{ secrets.AZURE__SUBSCRIPTION_ID }}
  ARM_TENANT_ID: ${{ secrets.AZURE__TENANT_ID }}
  ARM_CLIENT_ID: ${{ secrets.AZURE__CLIENT_ID }}
  ARM_CLIENT_SECRET: ${{ secrets.AZURE__CLIENT_SECRET }}
  TF_LOG: "INFO"

jobs:
  dev:
    name: Deploy to dev
    uses: ./.github/workflows/deploy-terraform.yaml
    with:
      gith-environment: dev
      terraform-workspace: dev
    secrets: inherit
  
  prod:
    name: Deploy to prod
    uses: ./.github/workflows/deploy-terraform.yaml
    with:
      gith-environment: prod
      terraform-workspace: prod
    needs: dev
    secrets: inherit